import{a as U,d as $,b as O,r as o,j as s,a0 as v,B as g,T as G,S as W}from"./index-XzM8Cj3c.js";import{u as H}from"./useFetchSportsByCategory-CyELs5aP.js";import{u as J}from"./useFetchvendorVenues-D949lnpY.js";import{a as K}from"./useUpdateCoupon-Cc9Ux2NW.js";import{d as T,D as w}from"./index-B_VpdSuJ.js";import{F as n}from"./index-BLf5ALDk.js";import{s as f}from"./index-Yvuj0Esb.js";import{R as Q}from"./ArrowLeftOutlined-DMqiT_4K.js";import{R as L,a as X}from"./endpointApi-DfRgDSAn.js";import{C as Z}from"./index-C1XA4k9t.js";import{S as k}from"./index-Ci-vNBFy.js";import{I as M}from"./index-Vt2X7eqz.js";import{R as D}from"./index-BZS9dDwd.js";import{T as ee}from"./index-D0YoyXJ1.js";import"./useQuery-Beh9q-Hu.js";import"./endpointApi-onWuI-MI.js";import"./useMutation-CNNl5TnA.js";import"./SearchOutlined-B0571LVy.js";import"./useForm-EwlPOCpB.js";import"./row-CTTWbxgc.js";import"./index-BfZvbS5e.js";import"./ExclamationCircleFilled-D7dRXMD9.js";import"./InfoCircleFilled-Ce5_6Fhy.js";import"./Skeleton-BxJpOdZN.js";import"./PlusOutlined-Dj0tFLrA.js";import"./Input-BUj1c9yh.js";import"./EyeOutlined-BVmecd_y.js";import"./useBubbleLock-B-1WFybW.js";const{TextArea:se}=M,{Option:te}=k,{Title:ae,Text:_}=G;function we(){const I=U(),x=$();O(e=>e.auth.user.id);const[l]=n.useForm(),[d,j]=o.useState(null),[b,A]=o.useState(!1),[i,m]=o.useState(["All Sports"]),[r,R]=o.useState(null),{data:u,loading:N,error:C}=J(),{data:p,loading:V,error:E}=H(1),S=K();o.useEffect(()=>{if(x.state?.couponData){const e=x.state.couponData;if(R(e),j(e.venueId),l.setFieldsValue({selectVenue:e.venueId,couponCode:e.coupon,couponType:e.type==="Upto"?"percentage":"flat",value:parseFloat(e.value.replace(/[%₹]/g,"")),startDate:e.startDate?T(e.startDate):null,endDate:e.rawExpiryDate?T(e.rawExpiryDate):null,description:e.description}),e.isAllSports===1&&(!e.sportsIds||e.sportsIds.length===0))m(["All Sports"]);else if(e.sportsIds&&e.sportsIds.length>0){const a=e.sportsIds.map(t=>p?.result?.find(h=>h.id===t)?.sports_name||`Sport ${t}`).filter(Boolean);m(a.length>0?a:["All Sports"])}else m(["All Sports"])}},[x.state,l,p]),o.useEffect(()=>{if(r&&p?.result)if(r.isAllSports===1&&(!r.sportsIds||r.sportsIds.length===0))m(["All Sports"]);else if(r.sportsIds&&r.sportsIds.length>0){const e=r.sportsIds.map(a=>p.result.find(c=>c.id===a)?.sports_name||`Sport ${a}`).filter(Boolean);m(e.length>0?e:["All Sports"])}else m(["All Sports"])},[r,p?.result]),o.useEffect(()=>{u?.resutl?.length&&!d&&!r&&(j(u.resutl[0].venue_id),l.setFieldsValue({selectVenue:u.resutl[0].venue_id}))},[u,d,l,r]),o.useEffect(()=>{C&&f.error("Failed to load venue list"),E&&f.error("Failed to load sports list")},[C,E]),o.useEffect(()=>{l.setFieldsValue({sport:i})},[i,l]);const q=o.useMemo(()=>u?.resutl?.find(e=>e.venue_id===d),[u?.resutl,d]),B=o.useCallback(e=>{j(e),l.setFieldsValue({selectVenue:e})},[l]),F=o.useCallback(e=>{m(a=>{let t;return e==="All Sports"?t=["All Sports"]:a.includes(e)?(t=a.filter(c=>c!==e),t=t.length===0?["All Sports"]:t):(t=a.filter(c=>c!=="All Sports"),t=[...t,e]),l.setFieldsValue({sport:t}),t})},[l]),P=o.useMemo(()=>p?.result?p.result.map(e=>({id:e.id,name:e.sports_name,image:e.sports_images,status:e.status})):[],[p?.result]),Y=async e=>{try{A(!0),console.log("Form Values:",e),console.log("Selected Sports:",i),console.log("Selected Venue ID:",d),console.log("Form Field Names:",Object.keys(e));const a=i.includes("All Sports"),t=a?[]:i.filter(y=>y!=="All Sports").map(y=>P.find(z=>z.name===y)?.id).filter(Boolean),c={couponId:r.id,venueId:d,couponCode:e.couponCode,couponType:e.couponType,value:e.value,description:e.description,startDate:e.startDate?.format("YYYY-MM-DD"),endDate:e.endDate?.format("YYYY-MM-DD"),sportsIds:t,isAllSports:a?1:0,status:1};console.log("API Payload:",c);const h=await S.mutateAsync(c);if(h.status===200)f.success("Discount coupon updated successfully!"),f.loading("Refreshing coupon list...",1),I("/vendor/manage/discount");else throw new Error(h.message||"Failed to update coupon")}catch(a){console.error("Error updating coupon:",a),f.error(a.message||"Failed to update discount coupon. Please try again.")}finally{A(!1)}};return r?N||V?s.jsx("div",{className:"add-coupon-conatiner",children:s.jsxs("div",{className:"page-loading-container",children:[s.jsx(v,{size:"large"}),s.jsx("div",{className:"page-loading-text",children:N?"Loading venues...":"Loading sports..."})]})}):s.jsxs("div",{className:"add-coupon-conatiner",children:[s.jsxs("div",{className:"coupon-header-compact",children:[s.jsxs("div",{className:"header-left",children:[s.jsx(g,{type:"text",icon:s.jsx(Q,{}),onClick:()=>I("/vendor/manage/discount"),className:"back-button-compact",children:"Back"}),s.jsxs("div",{className:"header-title",children:[s.jsx(L,{className:"title-icon"}),s.jsx(ae,{level:3,className:"coupon-title-compact",children:"Edit Discount Coupon"})]})]}),s.jsx("div",{className:"header-right",children:s.jsx(_,{type:"secondary",className:"venue-info",children:q?.venue_name||"Select venue"})})]}),s.jsx(Z,{className:"coupon-form-card-compact",children:s.jsxs(n,{layout:"vertical",onFinish:Y,form:l,className:"coupon-form-compact",children:[s.jsxs("div",{className:"form-grid",children:[s.jsxs("div",{className:"form-column",children:[s.jsx(n.Item,{name:"selectVenue",label:"Venue",rules:[{required:!0,message:"Please select a venue"}],className:"form-item-compact",children:s.jsx(k,{placeholder:"Select Venue",className:"venue-select-compact",loading:N,onChange:B,value:d,children:u?.resutl?.map(e=>s.jsx(te,{value:e.venue_id,children:e.venue_name},e.venue_id))})}),s.jsx(n.Item,{name:"couponCode",label:"Coupon Code",rules:[{required:!0,message:"Please enter coupon code"}],className:"form-item-compact",children:s.jsx(M,{placeholder:"e.g., WELCOME20",className:"form-input-compact"})}),s.jsx(n.Item,{name:"couponType",label:"Type",rules:[{required:!0,message:"Please select type"}],className:"form-item-compact",children:s.jsxs(D.Group,{className:"radio-group-compact",children:[s.jsxs(D,{value:"percentage",className:"radio-btn-compact",children:[s.jsx(X,{}),"Percentage"]}),s.jsxs(D,{value:"flat",className:"radio-btn-compact",children:[s.jsx(L,{}),"Fixed"]})]})}),s.jsx(n.Item,{name:"value",label:"Discount Value",rules:[{required:!0,message:"Please enter value"}],className:"form-item-compact",children:s.jsx(ee,{suffix:"₹",style:{width:"100%"},placeholder:"Enter value",className:"form-input-compact"})})]}),s.jsxs("div",{className:"form-column",children:[s.jsx(n.Item,{name:"startDate",label:"Start Date",rules:[{required:!0,message:"Please select start date"}],className:"form-item-compact",children:s.jsx(w,{style:{width:"100%"},className:"form-input-compact",placeholder:"Start date"})}),s.jsx(n.Item,{name:"endDate",label:"Expiry Date",rules:[{required:!0,message:"Please select expiry date"}],className:"form-item-compact",children:s.jsx(w,{style:{width:"100%"},className:"form-input-compact",placeholder:"Expiry date"})})]})]}),s.jsxs("div",{className:"form-full-width",children:[s.jsx(n.Item,{name:"description",label:"Description",rules:[{required:!0,message:"Please enter description"}],className:"form-item-compact",children:s.jsx(se,{placeholder:"Brief description of the coupon offer...",rows:2,className:"form-textarea-compact"})}),s.jsx(n.Item,{name:"sport",label:"Applicable Sports",rules:[{required:!0,message:"Please select sports"}],className:"form-item-compact",initialValue:i,children:s.jsx("div",{className:"sports-selection-container",children:V?s.jsxs("div",{className:"sports-loading",children:[s.jsx(v,{size:"small"}),s.jsx(_,{type:"secondary",style:{marginLeft:8},children:"Loading sports..."})]}):s.jsxs(W,{wrap:!0,className:"sports-container",children:[s.jsx(g,{type:i.includes("All Sports")?"primary":"default",onClick:()=>F("All Sports"),className:"sport-button-compact",size:"small",children:"All Sports"},"All Sports"),P.map(e=>s.jsx(g,{type:i.includes(e.name)?"primary":"default",onClick:()=>F(e.name),className:"sport-button-compact",size:"small",disabled:e.status!==1,children:e.name},e.id))]})})})]}),s.jsx("div",{className:"form-actions-compact",children:s.jsx(g,{type:"primary",htmlType:"submit",size:"large",loading:b||S.isPending,className:"submit-button-compact",block:!0,children:b||S.isPending?"Updating Coupon...":"Update Discount Coupon"})})]})})]}):s.jsx("div",{className:"add-coupon-conatiner",children:s.jsxs("div",{className:"page-loading-container",children:[s.jsx(v,{size:"large"}),s.jsx("div",{className:"page-loading-text",children:"Loading coupon data..."})]})})}export{we as default};
