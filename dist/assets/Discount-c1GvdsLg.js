import{a as L,b as U,r as a,j as e,a0 as m,B as C,T as d,a4 as _,S as $,a2 as k,m as M}from"./index-XzM8Cj3c.js";import{u as O,a as V,S as G}from"./useDeleteCoupon-Yi0sknSe.js";import{u as K,a as Y}from"./useUpdateCoupon-Cc9Ux2NW.js";import{s as u}from"./index-Yvuj0Esb.js";import{F as q}from"./Table-Dv9gfO7j.js";import{R as T,a as H}from"./endpointApi-DfRgDSAn.js";import{B as J}from"./index-D8JKXGq0.js";import{T as Q}from"./index-B9zQjaED.js";import{P as W}from"./index-CXwmGbA0.js";import{R as X}from"./DeleteOutlined-Ke0rSpX_.js";import"./useQuery-Beh9q-Hu.js";import"./useMutation-CNNl5TnA.js";import"./ExclamationCircleFilled-D7dRXMD9.js";import"./InfoCircleFilled-Ce5_6Fhy.js";import"./SearchOutlined-B0571LVy.js";import"./addEventListener-kraIZfrw.js";import"./index-Ci-vNBFy.js";import"./index-V8rTfzId.js";import"./useBubbleLock-B-1WFybW.js";import"./index-BZS9dDwd.js";import"./useForm-EwlPOCpB.js";import"./extendsObject-78o_rR5W.js";import"./Input-BUj1c9yh.js";import"./useClosable-B4NhgZhJ.js";import"./ActionButton-DmSr_qh1.js";const De=()=>{const x=L(),P=U(s=>s.auth.user.id),[A,Z]=a.useState(1),[y,ee]=a.useState(8),[g,N]=a.useState(!1),[I,b]=a.useState(null),[S,w]=a.useState(null),{data:j,loading:h,error:D,isFetching:r,refetch:c}=O(P,1);V();const o=K(),l=Y(),f=a.useMemo(()=>j?.result?j.result.map(s=>({key:s.id,id:s.id,venue:s.venue?.venue_name||"All Venues",venueId:s.linked_id,coupon:s.coupon_code,type:s.coupon_type==="percentage"?"Upto":"Fixed",value:s.coupon_type==="percentage"?`${s.value}%`:`â‚¹${s.value}`,banner:"No",expiry:s.expiry_date?new Date(s.expiry_date).toLocaleDateString("en-GB"):"N/A",status:s.status===1?"Active":"Inactive",created_at:s.created_at?new Date(s.created_at).toLocaleDateString("en-GB"):"N/A",description:s.coupon_description||"No description",maxDiscount:s.maximum_discount_value,minBookingValue:s.minium_booking_value,sportsIds:s.sports_id||[],isAllSports:s.isAllSports===1,startDate:s.start_date||null,rawExpiryDate:s.expiry_date||null,rawStatus:s.status,rawCouponType:s.coupon_type,rawValue:s.value})):[],[j?.result]);a.useEffect(()=>{D&&u.error("Failed to load coupons")},[D]),a.useEffect(()=>{console.log("ðŸ”„ Component mounted, refetching coupons..."),c()},[c]);const p=(A-1)*y,v=f.slice(p,p+y),z=a.useCallback(()=>{x("/vendor/manage/adddiscount")},[x]),R=a.useCallback(async s=>{try{N(!0),b(s.id);const t=await o.mutateAsync(s.id);if(t.status===200)u.success("Coupon deleted successfully"),console.log("ðŸ”„ Refreshing coupons list after delete..."),await c(),u.loading("Refreshing list...",1);else throw new Error(t.message||"Failed to delete coupon")}catch(t){u.error(t.message||"Failed to delete coupon")}finally{N(!1),b(null)}},[o,c]),F=a.useCallback(s=>{x("/vendor/manage/editcoupon",{state:{couponData:s}})},[x]),E=a.useCallback(async s=>{try{w(s.id);const t=s.rawStatus===1?0:1,n={couponId:s.id,status:t},i=await l.mutateAsync(n);if(i.status===200)u.success(`Coupon ${t===1?"activated":"deactivated"} successfully`),await c();else throw new Error(i.message||"Failed to update coupon status")}catch(t){u.error(t.message||"Failed to update coupon status")}finally{w(null)}},[l,c]),B=[{title:"Coupon",key:"coupon",width:250,render:(s,t,n)=>e.jsxs("div",{className:"coupon-info-cell",children:[e.jsx("div",{className:"coupon-icon",children:e.jsx(T,{style:{color:"#1163C7",fontSize:"20px"}})}),e.jsxs("div",{className:"coupon-details",children:[e.jsxs("div",{className:"coupon-name",children:[e.jsx(d.Text,{strong:!0,children:t.coupon}),e.jsx(J,{count:p+n+1,style:{backgroundColor:"#1163C7",marginLeft:8},size:"small"})]}),e.jsx("div",{className:"coupon-description",children:e.jsx(d.Text,{type:"secondary",style:{fontSize:"12px"},children:t.description})})]})]})},{title:"Type & Value",key:"typeValue",width:150,render:(s,t)=>e.jsxs("div",{className:"type-value-cell",children:[e.jsx("div",{className:"coupon-type",children:e.jsx(Q,{color:"blue",style:{borderRadius:12},children:t.type})}),e.jsxs("div",{className:"coupon-value",children:[e.jsx(H,{style:{color:"#1163C7",marginRight:4}}),e.jsx(d.Text,{strong:!0,style:{color:"#1163C7"},children:t.value})]})]})},{title:"Expiry",key:"expiry",width:120,render:(s,t)=>e.jsxs("div",{className:"expiry-cell",children:[e.jsx(_,{style:{color:"#1163C7",marginRight:4}}),e.jsx(d.Text,{children:t.expiry})]})},{title:"Status",key:"status",width:120,render:(s,t)=>{const n=S===t.id,i=g||l.isPending||o.isPending||r;return e.jsxs("div",{className:"status-cell",children:[e.jsx(G,{checked:t.rawStatus===1,loading:n,disabled:i,onChange:()=>E(t),checkedChildren:"Active",unCheckedChildren:"Inactive",style:{backgroundColor:t.rawStatus===1?"#52c41a":"#ff4d4f"}}),n&&e.jsx(m,{size:"small",style:{marginLeft:8}})]})}},{title:"Created",key:"created",width:120,render:(s,t)=>e.jsxs("div",{className:"created-cell",children:[e.jsx(_,{style:{color:"#1163C7",marginRight:4}}),e.jsx(d.Text,{type:"secondary",style:{fontSize:"12px"},children:t.created_at?new Date(t.created_at).toLocaleDateString():"N/A"})]})},{title:"Actions",key:"actions",width:120,render:(s,t)=>{const n=I===t.id;t.id;const i=g||l.isPending||o.isPending||r;return e.jsxs($,{size:"small",children:[e.jsx(k,{title:"Edit Coupon",children:e.jsx(C,{type:"text",icon:e.jsx(M,{}),size:"small",disabled:i,onClick:()=>F(t),className:"action-btn edit-btn"})}),e.jsx(k,{title:n?"Deleting...":"Delete Coupon",children:e.jsx(W,{title:"Are you sure you want to delete this coupon?",description:"This action cannot be undone.",onConfirm:()=>R(t),okText:"Yes, Delete",cancelText:"Cancel",disabled:i,children:e.jsx(C,{type:"text",danger:!0,icon:n?e.jsx(m,{size:"small"}):e.jsx(X,{}),size:"small",loading:n,disabled:i,className:"action-btn delete-btn"})})})]})}}];return h?e.jsx("div",{className:"venue-card",children:e.jsxs("div",{className:"page-loading-container",children:[e.jsx(m,{size:"large"}),e.jsx("div",{className:"page-loading-text",children:"Loading coupons..."})]})}):e.jsxs("div",{className:"venue-card",children:[e.jsx("div",{className:"venue-toolbar",children:e.jsxs(C,{type:"primary",className:"add-btn",disabled:g||l.isPending||o.isPending||r,onClick:z,children:["+ Add Discount Coupon",(g||l.isPending||o.isPending||r)&&e.jsx("span",{className:"processing-indicator",children:" (Processing...)"})]})}),e.jsxs("h3",{className:"venue-title",children:["Discount Coupons",r&&!h&&e.jsx(m,{size:"small",style:{marginLeft:8}})]}),e.jsxs("div",{className:"coupons-table-container",style:{position:"relative"},children:[r&&!h&&e.jsx("div",{style:{position:"absolute",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(255, 255, 255, 0.8)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:10,borderRadius:"6px"},children:e.jsxs("div",{style:{textAlign:"center"},children:[e.jsx(m,{size:"large"}),e.jsx("div",{style:{marginTop:8,color:"#666"},children:"Refreshing coupon list..."})]})}),v?.length>0?e.jsx(q,{columns:B,dataSource:v,pagination:!1,rowKey:"id",className:"enterprise-coupons-table",size:"middle",loading:h||l.isPending||o.isPending}):e.jsx("div",{className:"empty-state-container",children:e.jsxs("div",{className:"empty-state-content",children:[e.jsx("div",{className:"empty-state-icon",children:e.jsx(T,{})}),e.jsx("h3",{className:"empty-state-title",children:"No Discount Coupons Found"}),e.jsx("p",{className:"empty-state-description",children:`This venue doesn't have any discount coupons yet. Click the "ADD DISCOUNT COUPON" button to create your first coupon.`}),e.jsxs("div",{className:"empty-state-info",children:[e.jsxs("div",{className:"info-item",children:[e.jsx("span",{className:"info-label",children:"Coupon Types:"}),e.jsx("span",{className:"info-value",children:"Percentage, Fixed Amount, Buy One Get One"})]}),e.jsxs("div",{className:"info-item",children:[e.jsx("span",{className:"info-label",children:"Features:"}),e.jsx("span",{className:"info-value",children:"Expiry dates, Banner display, Usage limits"})]})]})]})})]}),v?.length>0&&e.jsx("div",{className:"coupons-footer",children:e.jsx("div",{className:"pagination-info",children:e.jsxs(d.Text,{type:"secondary",children:["Showing ",p+1,"-",Math.min(p+y,f.length)," of ",f.length," coupons"]})})})]})};export{De as default};
