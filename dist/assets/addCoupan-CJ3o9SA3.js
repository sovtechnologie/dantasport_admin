import{a as q,b as Y,r as a,j as e,a0 as V,B as u,T as B,S as z}from"./index-XzM8Cj3c.js";import{u as O}from"./useFetchSportsByCategory-CyELs5aP.js";import{u as $}from"./useFetchvendorVenues-D949lnpY.js";import{u as G}from"./useCreateCoupon-BcxojVWh.js";import{F as o}from"./index-BLf5ALDk.js";import{s as d}from"./index-Yvuj0Esb.js";import{R as W}from"./ArrowLeftOutlined-DMqiT_4K.js";import{R as F,a as H}from"./endpointApi-DfRgDSAn.js";import{C as J}from"./index-C1XA4k9t.js";import{S as T}from"./index-Ci-vNBFy.js";import{I as k}from"./index-Vt2X7eqz.js";import{R as g}from"./index-BZS9dDwd.js";import{T as K}from"./index-D0YoyXJ1.js";import{D as P}from"./index-B_VpdSuJ.js";import"./useQuery-Beh9q-Hu.js";import"./endpointApi-onWuI-MI.js";import"./useMutation-CNNl5TnA.js";import"./useForm-EwlPOCpB.js";import"./row-CTTWbxgc.js";import"./index-BfZvbS5e.js";import"./ExclamationCircleFilled-D7dRXMD9.js";import"./InfoCircleFilled-Ce5_6Fhy.js";import"./SearchOutlined-B0571LVy.js";import"./Skeleton-BxJpOdZN.js";import"./PlusOutlined-Dj0tFLrA.js";import"./Input-BUj1c9yh.js";import"./EyeOutlined-BVmecd_y.js";import"./useBubbleLock-B-1WFybW.js";const{TextArea:Q}=k,{Option:U}=T,{Title:X,Text:E}=B;function Ve(){const j=q();Y(s=>s.auth.user.id);const[r]=o.useForm(),[n,N]=a.useState(null),[y,S]=a.useState(!1),[c,w]=a.useState(["All Sports"]),{data:i,loading:p,error:v}=$(),{data:f,loading:b,error:C}=O(1),h=G();a.useEffect(()=>{i?.resutl?.length&&!n&&(N(i.resutl[0].venue_id),r.setFieldsValue({selectVenue:i.resutl[0].venue_id}))},[i,n,r]),a.useEffect(()=>{v&&d.error("Failed to load venue list"),C&&d.error("Failed to load sports list")},[v,C]),a.useEffect(()=>{r.setFieldsValue({sport:c})},[c,r]);const L=a.useMemo(()=>i?.resutl?.find(s=>s.venue_id===n),[i?.resutl,n]),M=a.useCallback(s=>{N(s),r.setFieldsValue({selectVenue:s})},[r]),D=a.useCallback(s=>{w(l=>{let t;return s==="All Sports"?t=["All Sports"]:l.includes(s)?(t=l.filter(m=>m!==s),t=t.length===0?["All Sports"]:t):(t=l.filter(m=>m!=="All Sports"),t=[...t,s]),r.setFieldsValue({sport:t}),t})},[r]),I=a.useMemo(()=>f?.result?f.result.map(s=>({id:s.id,name:s.sports_name,image:s.sports_images,status:s.status})):[],[f?.result]),R=async s=>{try{S(!0),console.log("Form Values:",s),console.log("Selected Sports:",c),console.log("Selected Venue ID:",n),console.log("Form Field Names:",Object.keys(s));const l=c.includes("All Sports"),t=l?[]:c.filter(x=>x!=="All Sports").map(x=>I.find(_=>_.name===x)?.id).filter(Boolean),m={venueId:n,couponCode:s.couponCode,couponType:s.couponType,value:s.value,description:s.description,startDate:s.startDate?.format("YYYY-MM-DD"),endDate:s.endDate?.format("YYYY-MM-DD"),sportsIds:t,isAllSports:l?1:0,type:1};console.log("API Payload:",m);const A=await h.mutateAsync(m);if(A.status===200)d.success("Discount coupon created successfully!"),d.loading("Refreshing coupon list...",1),j("/vendor/manage/discount");else throw new Error(A.message||"Failed to create coupon")}catch(l){console.error("Error creating coupon:",l),d.error(l.message||"Failed to create discount coupon. Please try again.")}finally{S(!1)}};return p||b?e.jsx("div",{className:"add-coupon-conatiner",children:e.jsxs("div",{className:"page-loading-container",children:[e.jsx(V,{size:"large"}),e.jsx("div",{className:"page-loading-text",children:p?"Loading venues...":"Loading sports..."})]})}):e.jsxs("div",{className:"add-coupon-conatiner",children:[e.jsxs("div",{className:"coupon-header-compact",children:[e.jsxs("div",{className:"header-left",children:[e.jsx(u,{type:"text",icon:e.jsx(W,{}),onClick:()=>j("/vendor/manage/discount"),className:"back-button-compact",children:"Back"}),e.jsxs("div",{className:"header-title",children:[e.jsx(F,{className:"title-icon"}),e.jsx(X,{level:3,className:"coupon-title-compact",children:"Add Discount Coupon"})]})]}),e.jsx("div",{className:"header-right",children:e.jsx(E,{type:"secondary",className:"venue-info",children:L?.venue_name||"Select venue"})})]}),e.jsx(J,{className:"coupon-form-card-compact",children:e.jsxs(o,{layout:"vertical",onFinish:R,form:r,className:"coupon-form-compact",children:[e.jsxs("div",{className:"form-grid",children:[e.jsxs("div",{className:"form-column",children:[e.jsx(o.Item,{name:"selectVenue",label:"Venue",rules:[{required:!0,message:"Please select a venue"}],className:"form-item-compact",children:e.jsx(T,{placeholder:"Select Venue",className:"venue-select-compact",loading:p,onChange:M,value:n,children:i?.resutl?.map(s=>e.jsx(U,{value:s.venue_id,children:s.venue_name},s.venue_id))})}),e.jsx(o.Item,{name:"couponCode",label:"Coupon Code",rules:[{required:!0,message:"Please enter coupon code"}],className:"form-item-compact",children:e.jsx(k,{placeholder:"e.g., WELCOME20",className:"form-input-compact"})}),e.jsx(o.Item,{name:"couponType",label:"Type",rules:[{required:!0,message:"Please select type"}],className:"form-item-compact",children:e.jsxs(g.Group,{className:"radio-group-compact",children:[e.jsxs(g,{value:"percentage",className:"radio-btn-compact",children:[e.jsx(H,{}),"Percentage"]}),e.jsxs(g,{value:"flat",className:"radio-btn-compact",children:[e.jsx(F,{}),"Fixed"]})]})}),e.jsx(o.Item,{name:"value",label:"Discount Value",rules:[{required:!0,message:"Please enter value"}],className:"form-item-compact",children:e.jsx(K,{suffix:"â‚¹",style:{width:"100%"},placeholder:"Enter value",className:"form-input-compact"})})]}),e.jsxs("div",{className:"form-column",children:[e.jsx(o.Item,{name:"startDate",label:"Start Date",rules:[{required:!0,message:"Please select start date"}],className:"form-item-compact",children:e.jsx(P,{style:{width:"100%"},className:"form-input-compact",placeholder:"Start date"})}),e.jsx(o.Item,{name:"endDate",label:"Expiry Date",rules:[{required:!0,message:"Please select expiry date"}],className:"form-item-compact",children:e.jsx(P,{style:{width:"100%"},className:"form-input-compact",placeholder:"Expiry date"})})]})]}),e.jsxs("div",{className:"form-full-width",children:[e.jsx(o.Item,{name:"description",label:"Description",rules:[{required:!0,message:"Please enter description"}],className:"form-item-compact",children:e.jsx(Q,{placeholder:"Brief description of the coupon offer...",rows:2,className:"form-textarea-compact"})}),e.jsx(o.Item,{name:"sport",label:"Applicable Sports",rules:[{required:!0,message:"Please select sports"}],className:"form-item-compact",initialValue:c,children:e.jsx("div",{className:"sports-selection-container",children:b?e.jsxs("div",{className:"sports-loading",children:[e.jsx(V,{size:"small"}),e.jsx(E,{type:"secondary",style:{marginLeft:8},children:"Loading sports..."})]}):e.jsxs(z,{wrap:!0,className:"sports-container",children:[e.jsx(u,{type:c.includes("All Sports")?"primary":"default",onClick:()=>D("All Sports"),className:"sport-button-compact",size:"small",children:"All Sports"},"All Sports"),I.map(s=>e.jsx(u,{type:c.includes(s.name)?"primary":"default",onClick:()=>D(s.name),className:"sport-button-compact",size:"small",disabled:s.status!==1,children:s.name},s.id))]})})})]}),e.jsx("div",{className:"form-actions-compact",children:e.jsx(u,{type:"primary",htmlType:"submit",size:"large",loading:y||h.isPending,className:"submit-button-compact",block:!0,children:y||h.isPending?"Creating Coupon...":"Create Discount Coupon"})})]})})]})}export{Ve as default};
