import{a as V,b as B,r as a,j as e,a0 as G,B as p,T as z,S as _}from"./index-XzM8Cj3c.js";import{u as O}from"./useFetchSportsByCategory-CyELs5aP.js";import{a as $}from"./useFetchvendorVenues-D949lnpY.js";import{u as H}from"./useCreateCoupon-BcxojVWh.js";import{F as o}from"./index-BLf5ALDk.js";import{s as d}from"./index-Yvuj0Esb.js";import{R as J}from"./ArrowLeftOutlined-DMqiT_4K.js";import{R as P,a as K}from"./endpointApi-DfRgDSAn.js";import{C as Q}from"./index-C1XA4k9t.js";import{S as k}from"./index-Ci-vNBFy.js";import{I as w}from"./index-Vt2X7eqz.js";import{R as y}from"./index-BZS9dDwd.js";import{T as U}from"./index-D0YoyXJ1.js";import{D as T}from"./index-B_VpdSuJ.js";import"./useQuery-Beh9q-Hu.js";import"./endpointApi-onWuI-MI.js";import"./useMutation-CNNl5TnA.js";import"./useForm-EwlPOCpB.js";import"./row-CTTWbxgc.js";import"./index-BfZvbS5e.js";import"./ExclamationCircleFilled-D7dRXMD9.js";import"./InfoCircleFilled-Ce5_6Fhy.js";import"./SearchOutlined-B0571LVy.js";import"./Skeleton-BxJpOdZN.js";import"./PlusOutlined-Dj0tFLrA.js";import"./Input-BUj1c9yh.js";import"./EyeOutlined-BVmecd_y.js";import"./useBubbleLock-B-1WFybW.js";const{TextArea:W}=w,{Option:X}=k,{Title:Z,Text:E}=z;function Ge(){const x=V(),j=B(s=>s.auth.user.id),[r]=o.useForm(),[i,N]=a.useState(null),[S,b]=a.useState(!1),[c,L]=a.useState(["All Sports"]),{data:n,loading:u,error:I}=$(j),{data:f,loading:v,error:C}=O(1),g=H();a.useEffect(()=>{n?.result?.length&&!i&&(N(n.result[0].Id),r.setFieldsValue({selectGym:n.result[0].Id}))},[n,i,r]),a.useEffect(()=>{I&&d.error("Failed to load gym list"),C&&d.error("Failed to load sports list")},[I,C]),a.useEffect(()=>{r.setFieldsValue({sport:c})},[c,r]);const M=a.useMemo(()=>n?.result?.find(s=>s.Id===i),[n?.result,i]),R=a.useCallback(s=>{N(s),r.setFieldsValue({selectGym:s})},[r]),D=a.useCallback(s=>{L(l=>{let t;return s==="All Sports"?t=["All Sports"]:l.includes(s)?(t=l.filter(m=>m!==s),t=t.length===0?["All Sports"]:t):(t=l.filter(m=>m!=="All Sports"),t=[...t,s]),r.setFieldsValue({sport:t}),t})},[r]),A=a.useMemo(()=>f?.result?f.result.map(s=>({id:s.id,name:s.sports_name,image:s.sports_images,status:s.status})):[],[f?.result]),Y=async s=>{try{b(!0),console.log("Form Values:",s),console.log("Selected Sports:",c),console.log("Selected Gym ID:",i),console.log("Form Field Names:",Object.keys(s));const l=c.includes("All Sports"),t=l?[]:c.filter(h=>h!=="All Sports").map(h=>A.find(q=>q.name===h)?.id).filter(Boolean),m={vendorId:j,type:3,couponCode:s.couponCode,couponType:s.couponType,value:s.value,description:s.description,startDate:s.startDate?.format("YYYY-MM-DD"),endDate:s.endDate?.format("YYYY-MM-DD"),sportsIds:t,isAllSports:l?1:0,linkedId:i};console.log("API Payload:",m);const F=await g.mutateAsync(m);if(F.status===200)d.success("Gym discount coupon created successfully!"),d.loading("Refreshing gym coupon list...",1),x("/vendor/gym/discount");else throw new Error(F.message||"Failed to create gym coupon")}catch(l){console.error("Error creating gym coupon:",l),d.error(l.message||"Failed to create gym discount coupon. Please try again.")}finally{b(!1)}};return u||v?e.jsx("div",{className:"add-coupon-conatiner",children:e.jsxs("div",{className:"page-loading-container",children:[e.jsx(G,{size:"large"}),e.jsx("div",{className:"page-loading-text",children:u?"Loading gyms...":"Loading sports..."})]})}):e.jsxs("div",{className:"add-coupon-conatiner",children:[e.jsxs("div",{className:"coupon-header-compact",children:[e.jsxs("div",{className:"header-left",children:[e.jsx(p,{type:"text",icon:e.jsx(J,{}),onClick:()=>x("/vendor/gym/discount"),className:"back-button-compact",children:"Back"}),e.jsxs("div",{className:"header-title",children:[e.jsx(P,{className:"title-icon"}),e.jsx(Z,{level:3,className:"coupon-title-compact",children:"Add Gym Discount Coupon"})]})]}),e.jsx("div",{className:"header-right",children:e.jsx(E,{type:"secondary",className:"venue-info",children:M?.gym_name||"Select gym"})})]}),e.jsx(Q,{className:"coupon-form-card-compact",children:e.jsxs(o,{layout:"vertical",onFinish:Y,form:r,className:"coupon-form-compact",children:[e.jsxs("div",{className:"form-grid",children:[e.jsxs("div",{className:"form-column",children:[e.jsx(o.Item,{name:"selectGym",label:"Gym",rules:[{required:!0,message:"Please select a gym"}],className:"form-item-compact",children:e.jsx(k,{placeholder:"Select Gym",className:"venue-select-compact",loading:u,onChange:R,value:i,children:n?.result?.map(s=>e.jsx(X,{value:s.Id,children:s.gym_name},s.Id))})}),e.jsx(o.Item,{name:"couponCode",label:"Coupon Code",rules:[{required:!0,message:"Please enter coupon code"}],className:"form-item-compact",children:e.jsx(w,{placeholder:"e.g., GYM20",className:"form-input-compact"})}),e.jsx(o.Item,{name:"couponType",label:"Type",rules:[{required:!0,message:"Please select type"}],className:"form-item-compact",children:e.jsxs(y.Group,{className:"radio-group-compact",children:[e.jsxs(y,{value:"percentage",className:"radio-btn-compact",children:[e.jsx(K,{}),"Percentage"]}),e.jsxs(y,{value:"flat",className:"radio-btn-compact",children:[e.jsx(P,{}),"Fixed"]})]})}),e.jsx(o.Item,{name:"value",label:"Discount Value",rules:[{required:!0,message:"Please enter value"}],className:"form-item-compact",children:e.jsx(U,{suffix:"â‚¹",style:{width:"100%"},placeholder:"Enter value",className:"form-input-compact"})})]}),e.jsxs("div",{className:"form-column",children:[e.jsx(o.Item,{name:"startDate",label:"Start Date",rules:[{required:!0,message:"Please select start date"}],className:"form-item-compact",children:e.jsx(T,{style:{width:"100%"},className:"form-input-compact",placeholder:"Start date"})}),e.jsx(o.Item,{name:"endDate",label:"Expiry Date",rules:[{required:!0,message:"Please select expiry date"}],className:"form-item-compact",children:e.jsx(T,{style:{width:"100%"},className:"form-input-compact",placeholder:"Expiry date"})})]})]}),e.jsxs("div",{className:"form-full-width",children:[e.jsx(o.Item,{name:"description",label:"Description",rules:[{required:!0,message:"Please enter description"}],className:"form-item-compact",children:e.jsx(W,{placeholder:"Brief description of the gym coupon offer...",rows:2,className:"form-textarea-compact"})}),e.jsx(o.Item,{name:"sport",label:"Applicable Sports",rules:[{required:!0,message:"Please select sports"}],className:"form-item-compact",initialValue:c,children:e.jsx("div",{className:"sports-selection-container",children:v?e.jsxs("div",{className:"sports-loading",children:[e.jsx(G,{size:"small"}),e.jsx(E,{type:"secondary",style:{marginLeft:8},children:"Loading sports..."})]}):e.jsxs(_,{wrap:!0,className:"sports-container",children:[e.jsx(p,{type:c.includes("All Sports")?"primary":"default",onClick:()=>D("All Sports"),className:"sport-button-compact",size:"small",children:"All Sports"},"All Sports"),A.map(s=>e.jsx(p,{type:c.includes(s.name)?"primary":"default",onClick:()=>D(s.name),className:"sport-button-compact",size:"small",disabled:s.status!==1,children:s.name},s.id))]})})})]}),e.jsx("div",{className:"form-actions-compact",children:e.jsx(p,{type:"primary",htmlType:"submit",size:"large",loading:S||g.isPending,className:"submit-button-compact",block:!0,children:S||g.isPending?"Creating Gym Coupon...":"Create Gym Discount Coupon"})})]})})]})}export{Ge as default};
