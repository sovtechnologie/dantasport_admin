import{a as Z,n as M,r as i,j as r,B as c}from"./index-XzM8Cj3c.js";/* empty css                  */import{u as x}from"./UploadIcon-DVASWBXr.js";import{u as k}from"./useMutation-CNNl5TnA.js";import{c as R,U as B}from"./endpointApi-CicnUymp.js";import{u as G}from"./useFetchSingleVendor-Cgk2t_bK.js";import{F as s}from"./index-BLf5ALDk.js";import{R as w,C as h}from"./row-CTTWbxgc.js";import{I as l}from"./index-Vt2X7eqz.js";import{S as O}from"./index-Ci-vNBFy.js";import{U as j}from"./index-DpVHb5nB.js";import{s as m}from"./index-Yvuj0Esb.js";import"./useQuery-Beh9q-Hu.js";import"./useForm-EwlPOCpB.js";import"./ExclamationCircleFilled-D7dRXMD9.js";import"./index-BfZvbS5e.js";import"./Input-BUj1c9yh.js";import"./SearchOutlined-B0571LVy.js";import"./EyeOutlined-BVmecd_y.js";import"./fade-_qbex92f.js";import"./DeleteOutlined-Ke0rSpX_.js";import"./DownloadOutlined-D_mskBw8.js";import"./progress-DW_vC4dS.js";import"./InfoCircleFilled-Ce5_6Fhy.js";const $=()=>k({mutationKey:["UpdateSendOtp"],mutationFn:t=>{if(!t)throw new Error("payload is required");return console.log("in mutation section payload",t),R(t)},onSuccess:t=>(console.log("OTP sent successfully:",t),t),onError:t=>(console.error("Failed to send OTP:",t),t)}),K=()=>k({mutationKey:["updateVendorDetails"],mutationFn:t=>{if(!t)throw new Error("Payload is required to update vendor details");return B(t)},onSuccess:t=>{console.log("vendor details updated successfully",t)},onError:t=>{console.error("Failed to update vendor details",t)}}),{Option:p}=O,Ne=()=>{const t=Z(),{id:A}=M(),[a]=s.useForm(),[D,P]=i.useState(!1),[z,E]=i.useState(!1),[C,N]=i.useState(!1),[H,W]=i.useState(!1),[v,g]=i.useState(null),[F,S]=i.useState(null),[y,b]=i.useState(null),{data:I,isLoading:J}=G(A);i.useEffect(()=>{if(I?.result?.[0]){const e=I.result[0];a.setFieldsValue({vendorName:e.full_name||"",email:e.email||"",mobile:e.mobile_number||"",services:e.services||[],category:e.category||"",aadharNumber:e.aadhaar_number||"6345-3475-6349",gstNumber:e.gst_number||"",pancardNumber:e.pan_number||"",accountNumber:e.account_number?.toString()||"",bankName:e.bank_name||"",ifscCode:e.ifsc_code||""}),e.gst_doc&&a.setFieldsValue({gstDocument:[{uid:"-1",name:"GST Document",status:"done",url:e.gst_doc}]}),e.pan_doc&&a.setFieldsValue({pancardDoc:[{uid:"-2",name:"Pancard",status:"done",url:e.pan_doc}]}),e.passbook_or_cheque&&a.setFieldsValue({bankDoc:[{uid:"-3",name:"Passbook/Cheque",status:"done",url:e.passbook_or_cheque}]}),e.aadhaar_doc&&a.setFieldsValue({aadharDoc:[{uid:"-4",name:"Aadhaar Document",status:"done",url:e.aadhaar_doc}]})}},[I,a]);const{mutate:U}=$(),T=()=>{const e=a.getFieldValue("mobile");if(!e){m.error("Please enter a mobile number before sending OTP");return}N(!0),g(null),U({vendorMobileNumber:e},{onSuccess:o=>{N(!1),o?.status===200&&(m.success(o.message||"OTP sent successfully"),S(o?.result?.id),P(!0),g(null),a.setFields([{name:"mobile",errors:[]}]),a.setFieldsValue({otp:o?.result?.otp||""}))},onError:o=>{N(!1);const d=o?.response?.data?.message||o?.message||"Failed to send OTP";o?.response?.status===409?(console.log("error catch with status409",d),g(d),a.setFields([{name:"mobile",errors:[d]}]),a.validateFields(["mobile"]).catch(()=>{})):m.error(d)}})},q=e=>{g(null),P(!1),a.setFields([{name:"mobile",errors:[]}])},{mutate:V}=K(),_=()=>{b(null),E(!1),a.setFields([{name:"mobile",errors:[]}])},L=e=>{console.log("form valyes",e,e.bankDoc?.url);const o=e.otp;if(!F){a.setFields([{name:"otp",errors:["Please send OTP first before submitting"]}]);return}if(!o){m.error("Please enter OTP");return}F||a.setFields([{name:"otp",errors:["Please enter correct otp"]}]),b(null);const d=Number(o);if(isNaN(d)){m.error("OTP must be a numeric value");return}const n=new FormData;n.append("id",F),n.append("otp",d),n.append("vendorName",e.vendorName),n.append("services",e.services),n.append("vendorEmail",e.email),n.append("AadharNumber",e.aadharNumber),n.append("gstNumber",e.gstNumber),n.append("panNumber",e.pancardNumber),n.append("accountNumber",e.accountNumber),n.append("bankName",e.bankName),n.append("ifscCode",e.ifscCode),e.gstDocument?.[0]?.originFileObj&&n.append("gstDoc",e.gstDocument?.[0]?.originFileObj),e.pancardDoc?.[0]?.originFileObj&&n.append("panDoc",e.pancardDoc?.[0]?.originFileObj),e.bankDoc?.[0]?.originFileObj&&n.append("bankPassBook",e.bankDoc?.[0]?.originFileObj),e.aadharDoc?.[0]?.originFileObj&&n.append("aadharDoc",e.aadharDoc?.[0]?.originFileObj),console.log("formData",e.gstDocument?.[0]?.originFileObj,e.pancardDoc?.[0]?.originFileObj,e.bankDoc?.[0]?.originFileObj),V(n,{onSuccess:u=>{u?.status===200&&(m.success(u.message||"OTP verified successfully"),b(null),a.resetFields(),P(!1),E(!1),S(null),b(null),t("/admin/vendors"))},onError:u=>{const f=u?.response?.data?.message||u?.message||"OTP verification failed";u?.response?.status===409?(console.log("error catch with status 409",f),b(f),a.setFields([{name:"otp",errors:[f]}]),a.validateFields(["otp"]).catch(()=>{})):m.error(f)}})};return r.jsx("div",{className:"vendor-form-wrapper",children:r.jsxs(s,{form:a,layout:"vertical",onFinish:L,className:"vendor-form",children:[r.jsxs(w,{gutter:24,children:[r.jsxs(h,{span:12,children:[r.jsx("h3",{children:"Basic Information"}),r.jsx(s.Item,{label:"Enter Vendor Name",name:"vendorName",rules:[{required:!0}],children:r.jsx(l,{})}),r.jsx(s.Item,{label:"Enter Mobile Number",name:"mobile",validateStatus:v?"error":"",help:v||void 0,rules:[{required:!0,message:"Please enter mobile number"},{pattern:/^[0-9]+$/,message:"Mobile number must contain only digits"},{len:10,message:"Mobile number must be exactly 10 digits"}],children:r.jsx(l,{disabled:!0,addonAfter:r.jsx(c,{type:"link",className:"otp-button",onClick:T,disabled:C||D,children:D?"Sent!":"Send OTP"}),variant:"borderless",maxLength:10,minLength:10,onChange:q,onKeyPress:e=>{/[0-9]/.test(e.key)||e.preventDefault()},placeholder:"Enter 10-digit mobile number",className:"otp-input"})}),r.jsx(s.Item,{label:"Enter Services",name:"services",rules:[{required:!0}],children:r.jsxs(O,{placeholder:"Select services",mode:"multiple",allowClear:!0,children:[r.jsx(p,{value:"Sports",children:"Sports"}),r.jsx(p,{value:"Gym",children:"Gym"}),r.jsx(p,{value:"Event",children:"Event"}),r.jsx(p,{value:"Coach",children:"Coach"})]})})]}),r.jsxs(h,{span:12,children:[r.jsx("h3",{children:" "}),r.jsx(s.Item,{label:"Enter Email",name:"email",rules:[{required:!0,message:"Please enter your email"},{type:"email",message:"Please enter a valid email address"}],children:r.jsx(l,{})}),r.jsx(s.Item,{label:"Enter OTP",name:"otp",validateStatus:y?"error":void 0,help:y||void 0,rules:[{required:!0,message:"Please enter OTP"}],children:r.jsx(l,{onChange:_,maxLength:6,variant:"borderless",className:"otp-input"})}),r.jsx(s.Item,{label:"Enter Category",name:"category",rules:[{required:!1}],children:r.jsxs(O,{placeholder:"Select category",children:[r.jsx(p,{value:"category1",children:"Run/Event"}),r.jsx(p,{value:"category2",children:"Trainer/Academy"})]})})]})]}),r.jsxs(w,{gutter:24,children:[r.jsx(h,{span:24,children:r.jsx("h3",{children:"Other Information"})}),r.jsxs(h,{span:12,children:[r.jsx(s.Item,{label:"Enter Aadhar Number",name:"aadharNumber",rules:[{required:!0,message:"Please enter Aadhar number"},{pattern:/^[2-9]{1}[0-9]{3}\s[0-9]{4}\s[0-9]{4}$/,message:"Please enter a valid 12-digit Aadhar number (e.g. 1234 5678 9123)"}],children:r.jsx(l,{maxLength:14,placeholder:"Enter 12-digit Aadhar number",onKeyPress:e=>{/[0-9\s]/.test(e.key)||e.preventDefault()}})}),r.jsx(s.Item,{label:"GST Number",name:"gstNumber",rules:[{required:!0,message:"Please enter GST Number"},{pattern:/^[0-9]{2}[A-Z]{5}[0-9]{4}[A-Z]{1}[1-9A-Z]{1}Z[0-9A-Z]{1}$/,message:"Please enter a valid 15-character GSTIN (e.g. 29ABCDE1234F1Z5)"}],children:r.jsx(l,{maxLength:15,placeholder:"Enter 15-digit GSTIN"})}),r.jsx(s.Item,{label:"Pancard Number",name:"pancardNumber",rules:[{required:!0,message:"Please enter Pancard number"},{pattern:/^[A-Z]{5}[0-9]{4}[A-Z]{1}$/,message:"Please enter a valid PAN (e.g. ABCDE1234F)"}],children:r.jsx(l,{maxLength:10,placeholder:"Enter 10-character PAN",style:{textTransform:"uppercase"}})}),r.jsx(s.Item,{label:"Account Number",name:"accountNumber",rules:[{required:!0,message:"Please enter account number"},{pattern:/^[0-9]{9,18}$/,message:"Account number must be 9–18 digits"}],children:r.jsx(l,{maxLength:18,placeholder:"Enter bank account number",onKeyPress:e=>{/[0-9]/.test(e.key)||e.preventDefault()}})}),r.jsx(s.Item,{label:"Enter Bank Name",name:"bankName",rules:[{required:!0,message:"Please enter bank name"},{pattern:/^[A-Za-z ]{3,100}$/,message:"Bank name must be at least 3 letters and contain only alphabets"}],children:r.jsx(l,{placeholder:"Enter bank name",onKeyPress:e=>{/[A-Za-z ]/.test(e.key)||e.preventDefault()}})})]}),r.jsxs(h,{span:12,children:[r.jsx(s.Item,{label:"Upload Aadhar Document",name:"aadharDoc",rules:[{required:!0}],children:r.jsx(j,{beforeUpload:()=>!1,listType:"text",maxCount:1,onPreview:e=>{window.open(e.url||e.thumbUrl,"_blank")},showUploadList:{showPreviewIcon:!0,showRemoveIcon:!0},children:r.jsxs(c,{className:"upload-btn",children:[r.jsx("img",{src:x,alt:"upload"})," Upload Image"]})})}),r.jsx(s.Item,{label:"Upload GST Document",name:"gstDocument",valuePropName:"fileList",getValueFromEvent:e=>Array.isArray(e)?e:e&&e.fileList,rules:[{required:!0}],children:r.jsx(j,{beforeUpload:()=>!1,listType:"text",maxCount:1,onPreview:e=>{window.open(e.url||e.thumbUrl,"_blank")},showUploadList:{showPreviewIcon:!0,showRemoveIcon:!0},children:r.jsxs(c,{className:"upload-btn",children:[r.jsx("img",{src:x,alt:"upload"})," Upload Image"]})})}),r.jsx(s.Item,{label:"Upload Pancard",name:"pancardDoc",valuePropName:"fileList",getValueFromEvent:e=>Array.isArray(e)?e:e&&e.fileList,rules:[{required:!0}],children:r.jsx(j,{beforeUpload:()=>!1,maxCount:1,listType:"text",onPreview:e=>{window.open(e.url||e.thumbUrl,"_blank")},showUploadList:{showPreviewIcon:!0,showRemoveIcon:!0},children:r.jsxs(c,{className:"upload-btn",children:[r.jsx("img",{src:x,alt:"upload"})," Upload Image"]})})}),r.jsx(s.Item,{label:"IFSC Code",name:"ifscCode",rules:[{required:!0,message:"Please enter IFSC code"},{pattern:/^[A-Z]{4}0[A-Z0-9]{6}$/,message:"Enter a valid IFSC code (e.g., HDFC0001234)"}],children:r.jsx(l,{maxLength:11,placeholder:"Enter IFSC code",style:{textTransform:"uppercase"}})}),r.jsx(s.Item,{label:"Upload Bank Passbook/Canceled Cheque",name:"bankDoc",valuePropName:"fileList",getValueFromEvent:e=>Array.isArray(e)?e:e&&e.fileList,rules:[{required:!0}],children:r.jsx(j,{beforeUpload:()=>!1,listType:"text",maxCount:1,onPreview:e=>{window.open(e.url||e.thumbUrl,"_blank")},showUploadList:{showPreviewIcon:!0,showRemoveIcon:!0},children:r.jsxs(c,{className:"upload-btn",children:[r.jsx("img",{src:x,alt:"upload"})," Upload Image"]})})})]})]}),r.jsx(s.Item,{children:r.jsx("div",{className:"submit-button-wrapper",children:r.jsx(c,{type:"primary",htmlType:"submit",block:!0,className:"submit-button",children:"UPDATE VENDOR"})})})]})})};export{Ne as default};
