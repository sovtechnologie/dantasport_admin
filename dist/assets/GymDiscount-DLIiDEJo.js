import{a as L,b as $,r as a,j as e,a0 as p,B as C,T as o,a4 as _,S as B,a2 as k,m as U}from"./index-XzM8Cj3c.js";import{u as M,a as V,S as O}from"./useDeleteCoupon-Yi0sknSe.js";import{u as Y,a as K}from"./useUpdateCoupon-Cc9Ux2NW.js";import{s as u}from"./index-Yvuj0Esb.js";import{F as q}from"./Table-Dv9gfO7j.js";import{R as T,a as H}from"./endpointApi-DfRgDSAn.js";import{B as J}from"./index-D8JKXGq0.js";import{T as Q}from"./index-B9zQjaED.js";import{P as W}from"./index-CXwmGbA0.js";import{R as X}from"./DeleteOutlined-Ke0rSpX_.js";import"./useQuery-Beh9q-Hu.js";import"./useMutation-CNNl5TnA.js";import"./ExclamationCircleFilled-D7dRXMD9.js";import"./InfoCircleFilled-Ce5_6Fhy.js";import"./SearchOutlined-B0571LVy.js";import"./addEventListener-kraIZfrw.js";import"./index-Ci-vNBFy.js";import"./index-V8rTfzId.js";import"./useBubbleLock-B-1WFybW.js";import"./index-BZS9dDwd.js";import"./useForm-EwlPOCpB.js";import"./extendsObject-78o_rR5W.js";import"./Input-BUj1c9yh.js";import"./useClosable-B4NhgZhJ.js";import"./ActionButton-DmSr_qh1.js";const De=()=>{const g=L(),P=$(s=>s.auth.user.id),[I,Z]=a.useState(1),[h,ee]=a.useState(8),[y,N]=a.useState(!1),[A,b]=a.useState(null),[S,w]=a.useState(null),{data:j,loading:x,error:D,isFetching:c,refetch:d}=M(P,3);V();const l=Y(),r=K(),f=a.useMemo(()=>j?.result?j.result.map(s=>({key:s.id,id:s.id,gym:s.gym?.gym_name||"All Gyms",gymId:s.linked_id,coupon:s.coupon_code,type:s.coupon_type==="percentage"?"Upto":"Fixed",value:s.coupon_type==="percentage"?`${s.value}%`:`â‚¹${s.value}`,banner:"No",expiry:s.expiry_date?new Date(s.expiry_date).toLocaleDateString("en-GB"):"N/A",status:s.status===1?"Active":"Inactive",created_at:s.created_at?new Date(s.created_at).toLocaleDateString("en-GB"):"N/A",description:s.coupon_description||"No description",maxDiscount:s.maximum_discount_value,minBookingValue:s.minium_booking_value,sportsIds:s.sports_id||[],isAllSports:s.isAllSports===1,startDate:s.start_date||null,rawExpiryDate:s.expiry_date||null,rawStatus:s.status,rawCouponType:s.coupon_type,rawValue:s.value})):[],[j?.result]);a.useEffect(()=>{D&&u.error("Failed to load gym coupons")},[D]),a.useEffect(()=>{console.log("ðŸ”„ Component mounted, refetching gym coupons..."),d()},[d]);const m=(I-1)*h,v=f.slice(m,m+h),z=a.useCallback(()=>{g("/vendor/gym/adddiscount")},[g]),R=a.useCallback(async s=>{try{N(!0),b(s.id);const t=await l.mutateAsync(s.id);if(t.status===200)u.success("Gym coupon deleted successfully"),console.log("ðŸ”„ Refreshing gym coupons list after delete..."),await d(),u.loading("Refreshing list...",1);else throw new Error(t.message||"Failed to delete gym coupon")}catch(t){u.error(t.message||"Failed to delete gym coupon")}finally{N(!1),b(null)}},[l,d]),G=a.useCallback(s=>{g(`/vendor/gym/editdiscount/${s.id}`,{state:{couponData:s}})},[g]),F=a.useCallback(async s=>{try{w(s.id);const t=s.rawStatus===1?0:1,i={couponId:s.id,status:t},n=await r.mutateAsync(i);if(n.status===200)u.success(`Gym coupon ${t===1?"activated":"deactivated"} successfully`),await d();else throw new Error(n.message||"Failed to update gym coupon status")}catch(t){u.error(t.message||"Failed to update gym coupon status")}finally{w(null)}},[r,d]),E=[{title:"Coupon",key:"coupon",width:250,render:(s,t,i)=>e.jsxs("div",{className:"coupon-info-cell",children:[e.jsx("div",{className:"coupon-icon",children:e.jsx(T,{style:{color:"#1163C7",fontSize:"20px"}})}),e.jsxs("div",{className:"coupon-details",children:[e.jsxs("div",{className:"coupon-name",children:[e.jsx(o.Text,{strong:!0,children:t.coupon}),e.jsx(J,{count:m+i+1,style:{backgroundColor:"#1163C7",marginLeft:8},size:"small"})]}),e.jsx("div",{className:"coupon-description",children:e.jsx(o.Text,{type:"secondary",style:{fontSize:"12px"},children:t.description})})]})]})},{title:"Type & Value",key:"typeValue",width:150,render:(s,t)=>e.jsxs("div",{className:"type-value-cell",children:[e.jsx("div",{className:"coupon-type",children:e.jsx(Q,{color:"blue",style:{borderRadius:12},children:t.type})}),e.jsxs("div",{className:"coupon-value",children:[e.jsx(H,{style:{color:"#1163C7",marginRight:4}}),e.jsx(o.Text,{strong:!0,style:{color:"#1163C7"},children:t.value})]})]})},{title:"Gym",key:"gym",width:150,render:(s,t)=>e.jsxs("div",{className:"gym-cell",children:[e.jsx("div",{className:"gym-name",children:e.jsx(o.Text,{strong:!0,children:t.gym})}),e.jsx("div",{className:"gym-id",children:e.jsxs(o.Text,{type:"secondary",style:{fontSize:"12px"},children:["ID: ",t.gymId||"N/A"]})})]})},{title:"Expiry",key:"expiry",width:120,render:(s,t)=>e.jsxs("div",{className:"expiry-cell",children:[e.jsx(_,{style:{color:"#1163C7",marginRight:4}}),e.jsx(o.Text,{children:t.expiry})]})},{title:"Status",key:"status",width:120,render:(s,t)=>{const i=S===t.id,n=y||r.isPending||l.isPending||c;return e.jsxs("div",{className:"status-cell",children:[e.jsx(O,{checked:t.rawStatus===1,loading:i,disabled:n,onChange:()=>F(t),checkedChildren:"Active",unCheckedChildren:"Inactive",style:{backgroundColor:t.rawStatus===1?"#52c41a":"#ff4d4f"}}),i&&e.jsx(p,{size:"small",style:{marginLeft:8}})]})}},{title:"Created",key:"created",width:120,render:(s,t)=>e.jsxs("div",{className:"created-cell",children:[e.jsx(_,{style:{color:"#1163C7",marginRight:4}}),e.jsx(o.Text,{type:"secondary",style:{fontSize:"12px"},children:t.created_at?new Date(t.created_at).toLocaleDateString():"N/A"})]})},{title:"Actions",key:"actions",width:120,render:(s,t)=>{const i=A===t.id;t.id;const n=y||r.isPending||l.isPending||c;return e.jsxs(B,{size:"small",children:[e.jsx(k,{title:"Edit Gym Coupon",children:e.jsx(C,{type:"text",icon:e.jsx(U,{}),size:"small",disabled:n,onClick:()=>G(t),className:"action-btn edit-btn"})}),e.jsx(k,{title:i?"Deleting...":"Delete Gym Coupon",children:e.jsx(W,{title:"Are you sure you want to delete this gym coupon?",description:"This action cannot be undone.",onConfirm:()=>R(t),okText:"Yes, Delete",cancelText:"Cancel",disabled:n,children:e.jsx(C,{type:"text",danger:!0,icon:i?e.jsx(p,{size:"small"}):e.jsx(X,{}),size:"small",loading:i,disabled:n,className:"action-btn delete-btn"})})})]})}}];return x?e.jsx("div",{className:"venue-card",children:e.jsxs("div",{className:"page-loading-container",children:[e.jsx(p,{size:"large"}),e.jsx("div",{className:"page-loading-text",children:"Loading gym coupons..."})]})}):e.jsxs("div",{className:"venue-card",children:[e.jsx("div",{className:"venue-toolbar",children:e.jsxs(C,{type:"primary",className:"add-btn",disabled:y||r.isPending||l.isPending||c,onClick:z,children:["+ Add Gym Discount Coupon",(y||r.isPending||l.isPending||c)&&e.jsx("span",{className:"processing-indicator",children:" (Processing...)"})]})}),e.jsxs("h3",{className:"venue-title",children:["Gym Discount Coupons",c&&!x&&e.jsx(p,{size:"small",style:{marginLeft:8}})]}),e.jsxs("div",{className:"coupons-table-container",style:{position:"relative"},children:[c&&!x&&e.jsx("div",{style:{position:"absolute",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(255, 255, 255, 0.8)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:10,borderRadius:"6px"},children:e.jsxs("div",{style:{textAlign:"center"},children:[e.jsx(p,{size:"large"}),e.jsx("div",{style:{marginTop:8,color:"#666"},children:"Refreshing gym coupon list..."})]})}),v?.length>0?e.jsx(q,{columns:E,dataSource:v,pagination:!1,rowKey:"id",className:"enterprise-coupons-table",size:"middle",loading:x||r.isPending||l.isPending}):e.jsx("div",{className:"empty-state-container",children:e.jsxs("div",{className:"empty-state-content",children:[e.jsx("div",{className:"empty-state-icon",children:e.jsx(T,{})}),e.jsx("h3",{className:"empty-state-title",children:"No Gym Discount Coupons Found"}),e.jsx("p",{className:"empty-state-description",children:`You haven't created any gym discount coupons yet. Click the "ADD GYM DISCOUNT COUPON" button to create your first coupon.`}),e.jsxs("div",{className:"empty-state-info",children:[e.jsxs("div",{className:"info-item",children:[e.jsx("span",{className:"info-label",children:"Coupon Types:"}),e.jsx("span",{className:"info-value",children:"Percentage, Fixed Amount"})]}),e.jsxs("div",{className:"info-item",children:[e.jsx("span",{className:"info-label",children:"Features:"}),e.jsx("span",{className:"info-value",children:"Expiry dates, Gym-specific discounts, Usage limits"})]})]})]})})]}),v?.length>0&&e.jsx("div",{className:"coupons-footer",children:e.jsx("div",{className:"pagination-info",children:e.jsxs(o.Text,{type:"secondary",children:["Showing ",m+1,"-",Math.min(m+h,f.length)," of ",f.length," gym coupons"]})})})]})};export{De as default};
