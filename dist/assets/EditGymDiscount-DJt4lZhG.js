import{a as $,d as O,n as H,b as J,r,j as s,a0 as I,B as f,T as K,S as Q}from"./index-XzM8Cj3c.js";import{u as W}from"./useFetchSportsByCategory-CyELs5aP.js";import{a as X}from"./useFetchvendorVenues-D949lnpY.js";import{a as Z}from"./useUpdateCoupon-Cc9Ux2NW.js";import{d as T,D as k}from"./index-B_VpdSuJ.js";import{F as c}from"./index-BLf5ALDk.js";import{s as g}from"./index-Yvuj0Esb.js";import{R as ee}from"./ArrowLeftOutlined-DMqiT_4K.js";import{R as w,a as se}from"./endpointApi-DfRgDSAn.js";import{C as te}from"./index-C1XA4k9t.js";import{S as R}from"./index-Ci-vNBFy.js";import{I as B}from"./index-Vt2X7eqz.js";import{R as v}from"./index-BZS9dDwd.js";import{T as oe}from"./index-D0YoyXJ1.js";import"./useQuery-Beh9q-Hu.js";import"./endpointApi-onWuI-MI.js";import"./useMutation-CNNl5TnA.js";import"./SearchOutlined-B0571LVy.js";import"./useForm-EwlPOCpB.js";import"./row-CTTWbxgc.js";import"./index-BfZvbS5e.js";import"./ExclamationCircleFilled-D7dRXMD9.js";import"./InfoCircleFilled-Ce5_6Fhy.js";import"./Skeleton-BxJpOdZN.js";import"./PlusOutlined-Dj0tFLrA.js";import"./Input-BUj1c9yh.js";import"./EyeOutlined-BVmecd_y.js";import"./useBubbleLock-B-1WFybW.js";const{TextArea:ae}=B,{Option:re}=R,{Title:le,Text:L}=K;function Re(){const x=$(),y=O(),{id:M}=H(),Y=J(e=>e.auth.user.id),[l]=c.useForm(),[n,j]=r.useState(null),[b,G]=r.useState(!1),[m,p]=r.useState(["All Sports"]),[a,q]=r.useState(null),{data:u,loading:S,error:A}=X(Y),{data:d,loading:C,error:E}=W(1),N=Z();r.useEffect(()=>{if(console.log("ðŸ“‹ EditGymDiscount - Location state:",y.state),console.log("ðŸ“‹ EditGymDiscount - Coupon ID from params:",M),y.state?.couponData){const e=y.state.couponData;if(console.log("ðŸ“‹ EditGymDiscount - Received coupon data:",e),q(e),j(e.gymId),l.setFieldsValue({selectGym:e.gymId,couponCode:e.coupon,couponType:e.type==="Upto"?"percentage":"flat",value:parseFloat(e.value.replace(/[%â‚¹]/g,"")),startDate:e.startDate?T(e.startDate):null,endDate:e.rawExpiryDate?T(e.rawExpiryDate):null,description:e.description}),e.isAllSports===1&&(!e.sportsIds||e.sportsIds.length===0))p(["All Sports"]);else if(e.sportsIds&&e.sportsIds.length>0){const o=e.sportsIds.map(t=>d?.result?.find(h=>h.id===t)?.sports_name||`Sport ${t}`).filter(Boolean);p(o.length>0?o:["All Sports"])}else p(["All Sports"])}},[y.state,l,d]),r.useEffect(()=>{if(a&&d?.result)if(a.isAllSports===1&&(!a.sportsIds||a.sportsIds.length===0))p(["All Sports"]);else if(a.sportsIds&&a.sportsIds.length>0){const e=a.sportsIds.map(o=>d.result.find(i=>i.id===o)?.sports_name||`Sport ${o}`).filter(Boolean);p(e.length>0?e:["All Sports"])}else p(["All Sports"])},[a,d?.result]),r.useEffect(()=>{u?.result?.length&&!n&&!a&&(j(u.result[0].Id),l.setFieldsValue({selectGym:u.result[0].Id}))},[u,n,l,a]),r.useEffect(()=>{A&&g.error("Failed to load gym list"),E&&g.error("Failed to load sports list")},[A,E]),r.useEffect(()=>{l.setFieldsValue({sport:m})},[m,l]);const V=r.useMemo(()=>u?.result?.find(e=>e.Id===n),[u?.result,n]),z=r.useCallback(e=>{j(e),l.setFieldsValue({selectGym:e})},[l]),F=r.useCallback(e=>{p(o=>{let t;return e==="All Sports"?t=["All Sports"]:o.includes(e)?(t=o.filter(i=>i!==e),t=t.length===0?["All Sports"]:t):(t=o.filter(i=>i!=="All Sports"),t=[...t,e]),l.setFieldsValue({sport:t}),t})},[l]),P=r.useMemo(()=>d?.result?d.result.map(e=>({id:e.id,name:e.sports_name,image:e.sports_images,status:e.status})):[],[d?.result]),_=async e=>{try{G(!0),console.log("Form Values:",e),console.log("Selected Sports:",m),console.log("Selected Gym ID:",n),console.log("Form Field Names:",Object.keys(e));const o=m.includes("All Sports"),t=o?[]:m.filter(D=>D!=="All Sports").map(D=>P.find(U=>U.name===D)?.id).filter(Boolean),i={couponId:a.id,venueId:n,couponCode:e.couponCode,couponType:e.couponType,value:e.value,description:e.description,startDate:e.startDate?.format("YYYY-MM-DD"),endDate:e.endDate?.format("YYYY-MM-DD"),sportsIds:t,isAllSports:o?1:0,status:1,type:3};console.log("ðŸ“¤ EditGymDiscount - API Payload:",i),console.log("ðŸ“¤ EditGymDiscount - Selected Gym ID:",n),console.log("ðŸ“¤ EditGymDiscount - Coupon Data:",a);const h=await N.mutateAsync(i);if(h.status===200)g.success("Gym discount coupon updated successfully!"),g.loading("Refreshing gym coupon list...",1),x("/vendor/gym/discount");else throw new Error(h.message||"Failed to update gym coupon")}catch(o){console.error("Error updating gym coupon:",o),g.error(o.message||"Failed to update gym discount coupon. Please try again.")}finally{G(!1)}};return a?S||C?s.jsx("div",{className:"add-coupon-conatiner",children:s.jsxs("div",{className:"page-loading-container",children:[s.jsx(I,{size:"large"}),s.jsx("div",{className:"page-loading-text",children:S?"Loading gyms...":"Loading sports..."})]})}):s.jsxs("div",{className:"add-coupon-conatiner",children:[s.jsxs("div",{className:"coupon-header-compact",children:[s.jsxs("div",{className:"header-left",children:[s.jsx(f,{type:"text",icon:s.jsx(ee,{}),onClick:()=>x("/vendor/gym/discount"),className:"back-button-compact",children:"Back"}),s.jsxs("div",{className:"header-title",children:[s.jsx(w,{className:"title-icon"}),s.jsx(le,{level:3,className:"coupon-title-compact",children:"Edit Gym Discount Coupon"})]})]}),s.jsx("div",{className:"header-right",children:s.jsx(L,{type:"secondary",className:"venue-info",children:V?.gym_name||"Select gym"})})]}),s.jsx(te,{className:"coupon-form-card-compact",children:s.jsxs(c,{layout:"vertical",onFinish:_,form:l,className:"coupon-form-compact",children:[s.jsxs("div",{className:"form-grid",children:[s.jsxs("div",{className:"form-column",children:[s.jsx(c.Item,{name:"selectGym",label:"Gym",rules:[{required:!0,message:"Please select a gym"}],className:"form-item-compact",children:s.jsx(R,{placeholder:"Select Gym",className:"venue-select-compact",loading:S,onChange:z,value:n,children:u?.result?.map(e=>s.jsx(re,{value:e.Id,children:e.gym_name},e.Id))})}),s.jsx(c.Item,{name:"couponCode",label:"Coupon Code",rules:[{required:!0,message:"Please enter coupon code"}],className:"form-item-compact",children:s.jsx(B,{placeholder:"e.g., GYM20",className:"form-input-compact"})}),s.jsx(c.Item,{name:"couponType",label:"Type",rules:[{required:!0,message:"Please select type"}],className:"form-item-compact",children:s.jsxs(v.Group,{className:"radio-group-compact",children:[s.jsxs(v,{value:"percentage",className:"radio-btn-compact",children:[s.jsx(se,{}),"Percentage"]}),s.jsxs(v,{value:"flat",className:"radio-btn-compact",children:[s.jsx(w,{}),"Fixed"]})]})}),s.jsx(c.Item,{name:"value",label:"Discount Value",rules:[{required:!0,message:"Please enter value"}],className:"form-item-compact",children:s.jsx(oe,{suffix:"â‚¹",style:{width:"100%"},placeholder:"Enter value",className:"form-input-compact"})})]}),s.jsxs("div",{className:"form-column",children:[s.jsx(c.Item,{name:"startDate",label:"Start Date",rules:[{required:!0,message:"Please select start date"}],className:"form-item-compact",children:s.jsx(k,{style:{width:"100%"},className:"form-input-compact",placeholder:"Start date"})}),s.jsx(c.Item,{name:"endDate",label:"Expiry Date",rules:[{required:!0,message:"Please select expiry date"}],className:"form-item-compact",children:s.jsx(k,{style:{width:"100%"},className:"form-input-compact",placeholder:"Expiry date"})})]})]}),s.jsxs("div",{className:"form-full-width",children:[s.jsx(c.Item,{name:"description",label:"Description",rules:[{required:!0,message:"Please enter description"}],className:"form-item-compact",children:s.jsx(ae,{placeholder:"Brief description of the gym coupon offer...",rows:2,className:"form-textarea-compact"})}),s.jsx(c.Item,{name:"sport",label:"Applicable Sports",rules:[{required:!0,message:"Please select sports"}],className:"form-item-compact",initialValue:m,children:s.jsx("div",{className:"sports-selection-container",children:C?s.jsxs("div",{className:"sports-loading",children:[s.jsx(I,{size:"small"}),s.jsx(L,{type:"secondary",style:{marginLeft:8},children:"Loading sports..."})]}):s.jsxs(Q,{wrap:!0,className:"sports-container",children:[s.jsx(f,{type:m.includes("All Sports")?"primary":"default",onClick:()=>F("All Sports"),className:"sport-button-compact",size:"small",children:"All Sports"},"All Sports"),P.map(e=>s.jsx(f,{type:m.includes(e.name)?"primary":"default",onClick:()=>F(e.name),className:"sport-button-compact",size:"small",disabled:e.status!==1,children:e.name},e.id))]})})})]}),s.jsx("div",{className:"form-actions-compact",children:s.jsx(f,{type:"primary",htmlType:"submit",size:"large",loading:b||N.isPending,className:"submit-button-compact",block:!0,children:b||N.isPending?"Updating Gym Coupon...":"Update Gym Discount Coupon"})})]})})]}):s.jsx("div",{className:"add-coupon-conatiner",children:s.jsxs("div",{className:"page-loading-container",children:[s.jsx(I,{size:"large"}),s.jsx("div",{className:"page-loading-text",children:"Loading gym coupon data..."}),s.jsx("div",{style:{marginTop:"16px"},children:s.jsx(f,{type:"primary",onClick:()=>x("/vendor/gym/discount"),children:"Back to Gym Discounts"})})]})})}export{Re as default};
